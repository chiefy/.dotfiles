export ASDF_GOLANG_MOD_VERSION_ENABLED=true
export AWS_REGION=us-east-1
export LANG=en_US.UTF-8
export WORK="${HOME}/Work"
export ZSH_AUTOSUGGEST_BUFFER_MAX_SIZE=50
export CLICOLOR=1

if [ -f /usr/local/etc/openssl/certs/zscaler_root_ca.pem ]; then
    export NODE_EXTRA_CA_CERTS=/usr/local/etc/openssl/certs/zscaler_root_ca.pem
fi

if [ -d ${WORK}/re-makefiles-common ]; then
    export MAKE_COMMON="${WORK}/re-makefiles-common"
fi

if uname | grep Darwin &>/dev/null && type brew &>/dev/null; then
    export IS_MAC=1
    FPATH="$(brew --prefix)/share/zsh/site-functions:${FPATH}"
fi

eval $(dircolors)

HISTFILE="${ZDOTDIR:-$HOME}/.zsh_history" # The path to the history file.
HISTSIZE=10000                            # The maximum number of events to save in the internal history.
SAVEHIST=10000                            # The maximum number of events to save in the history file.

setopt BANG_HIST              # Treat the '!' character specially during expansion.
setopt EXTENDED_HISTORY       # Write the history file in the ':start:elapsed;command' format.
setopt INC_APPEND_HISTORY     # Write to the history file immediately, not when the shell exits.
setopt SHARE_HISTORY          # Share history between all sessions.
setopt HIST_EXPIRE_DUPS_FIRST # Expire duplicate entries first when trimming history.
setopt HIST_IGNORE_DUPS       # Don't record an entry that was just recorded again.
setopt HIST_IGNORE_ALL_DUPS   # Delete old recorded entry if new entry is a duplicate.
setopt HIST_FIND_NO_DUPS      # Do not display a line previously found.
setopt HIST_IGNORE_SPACE      # Don't record an entry starting with a space.
setopt HIST_SAVE_NO_DUPS      # Don't write duplicate entries in the history file.
setopt HIST_REDUCE_BLANKS     # Remove superfluous blanks before recording entry.
setopt HIST_VERIFY            # Do not execute immediately upon history expansion.

# handy keybindings
bindkey "^A" beginning-of-line
bindkey "^E" end-of-line
bindkey "^K" kill-line
bindkey "^R" history-incremental-search-backward
bindkey "^P" history-search-backward
bindkey "^Y" accept-and-hold
bindkey "^N" insert-last-word
bindkey "^Q" push-line-or-edit
bindkey -s "^T" "^[Isudo ^[A" # "t" for "toughguy"

# aliases
alias ls='eza -al'
alias cat='bat --paging=never'
alias aal='aws-azure-login -m cli -p $AWS_PROFILE'
alias wo='cd $WORK'

# FZF config / setup
export FZF_DEFAULT_OPTS="--height 50% --layout=reverse --inline-info --border"

# disable sort when completing `git checkout`
zstyle ':completion:*:git-checkout:*' sort false

# set descriptions format to enable group support
# NOTE: don't use escape sequences here, fzf-tab will ignore them
zstyle ':completion:*:descriptions' format '[%d]'
# set list-colors to enable filename colorizing
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
# force zsh not to show completion menu, which allows fzf-tab to capture the unambiguous prefix
zstyle ':completion:*' menu no
# preview directory's content with eza when completing cd
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'eza -1 --color=always $realpath'
# switch group using `<` and `>`
zstyle ':fzf-tab:*' switch-group '<' '>'

# BAT config / setup
export BAT_THEME='gruvbox-dark'

# source antidote
if [ ! -z $IS_MAC ]; then
    source $(brew --prefix)/opt/antidote/share/antidote/antidote.zsh
else
    source ${ZDOTDIR:-~}/.antidote/antidote.zsh
fi

# initialize plugins statically with ${ZDOTDIR:-~}/.zsh_plugins.txt
antidote load

#load custom completions
fpath=(~/.completions $fpath)

# aws profile switcher
aws-profiles() {
  cat ~/.aws/credentials | grep '\[' | grep -v '#' | tr -d '[' | tr -d ']'
}

set-aws-profile() {
  local aws_profile=$1
  set -x
  export AWS_PROFILE=${aws_profile}
  set +x
}

# load completions
autoload -U compinit
compinit
